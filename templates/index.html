<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tap Game</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</h1>
  <p>–£—Ä–æ–≤–µ–Ω—å: {{ level }} | Point: {{ point }} | –ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: {{ rank }}</p>
  <progress value="{{ progress }}" max="{{ goal }}"></progress>

  {% if level >= 5 %}
  <form action="/upload_avatar" method="POST" enctype="multipart/form-data">
    <input type="file" name="avatar" required>
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
  </form>
  {% endif %}

  <img src="/uploads/{{ user.avatar }}" width="80">

  <form method="POST" id="tap-form">
    <button id="tap-btn">–ù–ê–ñ–ú–ò</button>
  </form>
  <p id="count">{{ user.clicks }} –Ω–∞–∂–∞—Ç–∏–π</p>

  <h2>üèÜ –¢–û–ü-10</h2>
  <ul>
    {% for u in top_users %}
      <li>{{ loop.index }}. {{ u.username }} ‚Äî {{ u.city or "–ì–æ—Ä–æ–¥ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω" }} ‚Äî {{ u.clicks }}</li>
    {% endfor %}
  </ul>

  <a href="/chat">–ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç</a> |
  <a href="/logout">–í—ã—Ö–æ–¥</a>

  <script>
    document.getElementById('tap-form').addEventListener('submit', async e => {
      e.preventDefault();
      const res = await fetch('/', { method: 'POST' });
      const data = await res.json();
      if (data.winner) alert('üéâ –í—ã –Ω–∞–∂–∞–ª–∏ 10000 —Ä–∞–∑ –∏ –≤—ã–∏–≥—Ä–∞–ª–∏ 1 —Ä—É–±–ª—å!');
      else document.getElementById('count').innerText = data.clicks + ' –Ω–∞–∂–∞—Ç–∏–π';
    });
  </script>
</body>
</html>
