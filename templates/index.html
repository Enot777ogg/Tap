 {% extends 'base.html' %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}
{% block content %}
<h2 class="text-center">–ü—Ä–∏–≤–µ—Ç, {{ user.username }}!</h2>
<p class="text-center">–í–∞—à–µ –º–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: <strong>#{{ place }}</strong></p>

<div class="d-grid gap-2 col-6 mx-auto my-4">
    <button id="tapBtn" class="btn btn-lg btn-danger py-3">–ù–ê–ñ–ú–ò!</button>
    <div id="countDisplay" class="text-center fs-4">–ù–∞–∂–∞—Ç–∏–π: {{ user.clicks }}</div>
</div>

<h4 class="mt-5 text-center">üèÜ –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤</h4>
<ul class="list-group">
    {% for u in users %}
    <li class="list-group-item d-flex justify-content-between">
        <span>{{ loop.index }}. {{ u.username }}</span>
        <span>{{ u.clicks }} üëÜ</span>
    </li>
    {% endfor %}
</ul>

<script>
document.getElementById("tapBtn").onclick = async () => {
    const res = await fetch("/tap", { method: "POST" });
    const data = await res.json();
    document.getElementById("countDisplay").innerText = `–ù–∞–∂–∞—Ç–∏–π: ${data.clicks}`;
    if (data.win) {
        alert("üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 1 —Ä—É–±–ª—å!");
    }
};

navigator.geolocation?.getCurrentPosition(pos => {
    fetch("/location", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            lat: pos.coords.latitude,
            lon: pos.coords.longitude
        })
    });
});
</script>
{% endblock %}
